<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>রক্তদাতা তথ্য</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: #f9f9f9; 
      min-height: 100vh; 
      display: flex; 
      flex-direction: column;
    }

    /* Header */
    header {
      background: linear-gradient(135deg, #c0392b, #e74c3c);
      color: white;
      padding: 15px 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    .header-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .logo {
      height: 50px;
      width: auto;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 0 8px rgba(255,255,255,0.5);
    }
    .header-title {
      font-size: 1.6em;
      font-weight: 700;
      letter-spacing: 1px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    .header-subtitle {
      font-size: 0.95em;
      opacity: 0.9;
      margin-top: 2px;
    }

    /* Main Content */
    main {
      flex: 1;
      padding: 20px;
      max-width: 700px;
      margin: 0 auto;
      width: 100%;
    }
    h2 { 
      text-align: center; 
      color: #c0392b; 
      font-size: 1.8em; 
      margin-bottom: 20px; 
    }
    form { 
      background: #fff; 
      padding: 25px; 
      border-radius: 14px; 
      box-shadow: 0 0 15px rgba(0,0,0,0.1); 
      border: 1px solid #eee;
    }
    label { 
      display: block; 
      margin: 10px 0 6px; 
      font-weight: 600; 
      font-size: 0.98em; 
      color: #2c3e50;
    }
    input, select, textarea { 
      width: 100%; 
      padding: 12px; 
      border-radius: 8px; 
      border: 1px solid #ddd; 
      margin-bottom: 14px; 
      font-size: 1em; 
      transition: border 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #e74c3c;
      box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
    }
    textarea { resize: vertical; min-height: 70px; }
    button { 
      width: 100%; 
      padding: 15px; 
      background: #e74c3c; 
      color: white; 
      font-size: 1.15em; 
      font-weight: 600;
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      transition: all 0.3s; 
      margin-top: 10px;
    }
    button:hover { 
      background: #c0392b; 
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(192, 57, 43, 0.3);
    }
    .id-display { 
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9); 
      padding: 14px; 
      border-radius: 10px; 
      text-align: center; 
      font-weight: bold; 
      color: #2e7d32; 
      font-size: 1.15em; 
      margin-bottom: 18px; 
      border: 1px solid #a5d6a7;
    }

    /* Loading Overlay */
    #loadingOverlay { 
      display: none; 
      position: fixed; 
      top: 0; left: 0; 
      width: 100%; height: 100%; 
      background: rgba(0,0,0,0.5); 
      z-index: 9999; 
      justify-content: center; 
      align-items: center; 
    }
    #loadingOverlay div { 
      border: 6px solid #f3f3f3; 
      border-top: 6px solid #e74c3c; 
      border-radius: 50%; 
      width: 60px; 
      height: 60px; 
      animation: spin 1s linear infinite; 
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Footer */
    footer {
      background: #2c3e50;
      color: #ecf0f1;
      text-align: center;
      padding: 20px 15px;
      font-size: 0.95em;
      margin-top: auto;
      line-height: 1.6;
    }
    footer a {
      color: #e74c3c;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s;
    }
    footer a:hover {
      color: #f39c12;
      text-decoration: underline;
    }
    .footer-links {
      margin-top: 8px;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .header-title { font-size: 1.4em; }
      .logo { height: 40px; }
      main { padding: 15px; }
      h2 { font-size: 1.5em; }
      form { padding: 18px; }
      footer { font-size: 0.88em; padding: 18px 12px; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="header-content">
      <img src="watermark.png" alt="Beautiful Dinajpur Logo" class="logo">
      <div>
        <div class="header-title">বিউটিফুল দিনাজপুর</div>
        <div class="header-subtitle">রক্তদানে জীবন বাঁচান</div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <h2>রক্তদাতা তথ্য ফর্ম</h2>

    <form id="donorForm">
      <div class="id-display" id="idDisplay">আইডি: DINAJ-XXXX (ফর্ম পূরণ করুন)</div>

      <label for="name">নাম</label>
      <input type="text" id="name" name="name" placeholder="আপনার নাম লিখুন" required>

      <label for="age">বয়স</label>
      <input type="number" id="age" name="age" placeholder="আপনার বয়স লিখুন" required>

      <label for="group">রক্তের গ্রুপ</label>
      <select id="group" name="group" required>
        <option value="">চয়ন করুন</option>
        <option>A+</option><option>A-</option>
        <option>B+</option><option>B-</option>
        <option>O+</option><option>O-</option>
        <option>AB+</option><option>AB-</option>
      </select>

      <label for="gender">লিঙ্গ</label>
      <select id="gender" name="gender" required>
        <option value="">চয়ন করুন</option>
        <option>পুরুষ</option><option>মহিলা</option><option>অন্যান্য</option>
      </select>

      <label for="mobile">মোবাইল</label>
      <input type="text" id="mobile" name="mobile" placeholder="যেমন: 017xxxxxxxx" required>

      <label for="upazila">উপজেলা</label>
      <select id="upazila" name="upazila" required>
        <option value="">চয়ন করুন</option>
      <option>বিরামপুর</option>
<option>বিরগঞ্জ</option>
<option>বোচাগঞ্জ</option>
<option>চিরিরবন্দর</option>
<option>দিনাজপুর সদর</option>
<option>ঘোড়াঘাট</option>
<option>হাকিমপুর</option>
<option>কাহারোল</option>
<option>খানসামা</option>
<option>নবাবগঞ্জ</option>
<option>পার্বতীপুর</option>
<option>ফুলবাড়ী</option>

      </select>

      <label for="last_time_donation">শেষ রক্তদান তারিখ</label>
      <input type="date" id="last_time_donation" name="last_time_donation">

      <label for="total_donation">মোট রক্তদান</label>
      <input type="number" id="total_donation" name="total_donation" min="0" value="0" required>

      <label for="comment">মন্তব্য</label>
      <textarea id="comment" name="comment" placeholder="যদি কোনো মন্তব্য থাকে লিখুন"></textarea>

      <button type="submit">সাবমিট করে কার্ড তৈরি করুন</button>
    </form>

    <div id="loadingOverlay"><div></div></div>
    <div id="message"></div>
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 <a href="https://beautifuldinajpur.com" target="_blank">বিউটিফুল দিনাজপুর</a> | রক্তদানে অংশ নিন, জীবন বাঁচান</p>
    <div class="footer-links">
      <p>যোগাযোগ: 
        <a href="tel:01712421463">01712-421463</a> | 
        <a href="mailto:beautifuldinajpur5200@gmail.com">beautifuldinajpur5200@gmail.com</a>
      </p>
    </div>
  </footer>

  <script>
    const webAppURL = 'https://script.google.com/macros/s/AKfycbzIGBws1QD23VHQxKJ-vRL1tU_0gpEqgi3b6IxDSowvm45s1rvQQhG8pNCQQf_Y-ANc8g/exec';

    function generateID() {
      const random = Math.floor(1000 + Math.random() * 9000);
      return `Beautiful_Dinaj-${random}`;
    }

    let generatedID = generateID();
    document.getElementById('idDisplay').textContent = `আইডি: ${generatedID}`;

    document.querySelectorAll('input, select').forEach(el => {
      el.addEventListener('input', () => {
        generatedID = generateID();
        document.getElementById('idDisplay').textContent = `আইডি: ${generatedID}`;
      });
    });

    document.getElementById('donorForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const msg = document.getElementById('message');
      const loading = document.getElementById('loadingOverlay');
      msg.innerHTML = '';
      loading.style.display = 'flex';

      const formData = new FormData(this);
      formData.append('id', generatedID);

      const fullData = {};
      formData.forEach((value, key) => fullData[key] = value);

      const cardData = {
        id: generatedID,
        name: fullData.name,
        group: fullData.group,
        mobile: fullData.mobile,
        upazila: fullData.upazila,  // এখন সরাসরি upazila নেবে
        total_donation: fullData.total_donation
      };

      fetch(webAppURL, { method: 'POST', body: formData })
        .then(res => res.text())
        .then(text => {
          loading.style.display = 'none';
          let result;
          try {
            result = JSON.parse(text);
          } catch (e) {
            msg.innerHTML = '<p style="color:red">Server error: Invalid response</p>';
            return;
          }
          if (result.result === 'success') {
            const query = new URLSearchParams(cardData).toString();
            window.location.href = `card-generator.html?${query}`;
          } else {
            msg.innerHTML = '<p style="color:red">Failed: ' + (result.message || 'Unknown error') + '</p>';
          }
        })
        .catch(err => {
          loading.style.display = 'none';
          msg.innerHTML = '<p style="color:red">Network error: ' + err.message + '</p>';
        });
    });
  </script>
</body>
</html>
