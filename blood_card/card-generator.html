<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>রক্তদাতা কার্ড জেনারেটর</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @font-face { font-family: 'Bornomala'; src: url('bornomala.ttf') format('truetype'); }
    body { 
      font-family: 'Bornomala', Arial, sans-serif; 
      background-color: #f4f4f4; 
      margin: 0; 
      padding: 15px 10px; 
      overflow-x: hidden; 
    }

    /* ফর্ম – সেন্টার */
    .form-section {
      max-width: 600px; 
      margin: 10px auto 20px; 
      text-align: center;
    }
    .form-section h1 { 
      color: #d32f2f; 
      font-size: 1.6em; 
      margin-bottom: 15px; 
    }

    /* ডাউনলোড বাটন */
    .download-btns {
      display: flex; 
      gap: 10px; 
      justify-content: center; 
      margin-top: 10px;
    }
    .btn-custom {
      flex: 1; 
      background-color: #d32f2f; 
      border-color: #d32f2f; 
      font-family: 'Bornomala', sans-serif; 
      font-size: 1.1em;
    }
    .btn-custom:hover { 
      background-color: #b71c1c; 
      border-color: #b71c1c; 
    }

    /* কার্ড কন্টেইনার – লেফট অ্যালাইন */
    .card-container {
      width: 1080px;
      max-width: 100%;
      margin: 0;
      transform-origin: top left;
      transition: transform 0.3s ease;
    }

    /* মোবাইলে পুরো কার্ড ফিট */
    @media (max-width: 576px) {
      .card-container { transform: scale(0.48); margin-top: 10px; }
      body { padding: 5px; }
    }
    @media (min-width: 577px) and (max-width: 768px) {
      .card-container { transform: scale(0.65); }
    }
    @media (min-width: 769px) and (max-width: 992px) {
      .card-container { transform: scale(0.8); }
    }
    @media (min-width: 993px) {
      .card-container { transform: scale(1); }
    }

    /* কার্ডের মূল ডিজাইন */
    .card-preview {
      position: relative; overflow: hidden; background: white; border: 2px solid #d32f2f;
      border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex; flex-direction: column;
      width: 1080px; height: 566px;
    }
    .card-preview::before {
      content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: url('watermark.png') no-repeat center; background-size: 50% 100%; opacity: 0.1; z-index: 0;
    }
    .floating-logo { position: absolute; top: 70px; right: 30px; z-index: 2; width: 120px; pointer-events: none; }
    .card-content-wrapper { position: relative; z-index: 1; opacity: 0.5; transition: opacity 0.3s; flex: 1; display: flex; flex-direction: column; }
    .card-preview.filled .card-content-wrapper { opacity: 1; }

    /* হেডার – টেক্সট + ID এক লাইনে */
    .card-header {
      background-color: #d32f2f; color: white; text-align: center; padding: 15px;
      font-size: 28px; font-weight: bold; flex-shrink: 0; line-height: 1.3;
    }
    .card-header .header-text { display: inline; }
    .card-header .id-number { display: inline; font-size: 20px; font-weight: normal; opacity: 0.9; }

    .card-content { display: flex; padding: 20px 20px 20px 5px; flex: 1; align-items: center; justify-content: flex-start; }
    .card-left { flex: 0 0 400px; text-align: center; display: flex; flex-direction: column; align-items: center; }
    .left-images { display: flex; align-items: center; justify-content: center; gap: 30px; margin-bottom: 10px; }
    .card-left img.blood-logo { width: 200px; height: 200px; object-fit: contain; }
    .user-photo { width: 150px; height: 150px; border-radius: 50%; overflow: hidden; border: 3px solid #d32f2f; background-color: #f0f0f0; position: relative; display: inline-block; }
    .user-photo.empty { border-color: #ccc; }
    .user-photo img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
    .blood-group-logo { margin-top: 10px; font-size: 32px; font-weight: bold; color: #d32f2f; text-transform: uppercase; border-bottom: 1px dotted #d32f2f; padding-bottom: 2px; display: inline-block; }

    .card-right { flex: 1; font-size: 24px; padding-left: 20px; }
    .card-right p { margin: 12px 0; font-weight: bold; word-wrap: break-word; }
    .card-right p span { border-bottom: 1px dotted #d32f2f; padding-bottom: 2px; display: inline-block; }

    .card-date { display: flex; justify-content: space-between; align-items: center; padding: 0 30px 8px; font-size: 18px; color: #666; background-color: #f5f5f5; border-top: 1px solid #e57979; flex-shrink: 0; }
    .date-left { text-align: left; flex: 1; }
    .producer-right { text-align: right; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .card-footer { width: 100%; background-color: #f5f5f5; text-align: center; padding: 12px; font-size: 18px; color: #666; flex-shrink: 0; z-index: 3; }
  </style>
</head>
<body>

  <!-- ফর্ম ও ডাউনলোড বাটন -->
  <div class="form-section">
    <h1>রক্তদাতা কার্ড জেনারেটর</h1>
    <div class="mb-3">
      <label for="userPhoto" class="form-label">আপনার ছবি আপলোড করুন (ঐচ্ছিক):</label>
      <input type="file" class="form-control" id="userPhoto" accept="image/*">
    </div>
    <div class="download-btns">
      <button type="button" class="btn btn-custom" id="downloadPNG">PNG ডাউনলোড</button>
      <button type="button" class="btn btn-custom" id="downloadPDF">PDF ডাউনলোড</button>
    </div>
  </div>

  <!-- কার্ড – লেফট থেকে শুরু -->
  <div class="card-container">
    <div id="card" class="card-preview">
      <img class="floating-logo" src="logo.png" alt="লোগো">
      <div class="card-content-wrapper">
        <div class="card-header" id="cardheader">
          <span class="header-text">রক্তদাতা কার্ড</span>
          <span class="id-number" id="cardID">, DINAJ-XXXX</span>
        </div>
        
        <div class="card-content">
          <div class="card-left">
            <div class="left-images">
              <img src="blood_logo.png" alt="রক্তদাতা আইকন" class="blood-logo">
              <div id="userPhotoContainer" class="user-photo empty">
                <img id="cardUserPhoto" src="" alt="ইউজার ছবি">
              </div>
            </div>
            <div class="blood-group-logo" id="logo-bg">রক্তের গ্রুপ: A+</div>
          </div>
          <div class="card-right">
            <p>নাম: <span id="cardname">রনি আবীর</span></p>
            <p>মোবাইল: <span id="cardmobile">০১৭১২৩৪৫৬৭৮</span></p>
            <p>ঠিকানা: <span id="cardupazila">দিনাজপুর, বোচাগঞ্জ</span></p>
            <p>রক্তদান: <span id="carddonations">৫ বার</span></p>
          </div>
        </div>
        <div class="card-date">
          <span id="carddate" class="date-left"></span>
          <span class="producer-right">কার্ড প্রদানকারী: Beautiful Dinajpur</span>
        </div>
        <div class="card-footer">আল-কুরআন, সূরা মায়িদা (৫:৩২)|যে ব্যক্তি একটি প্রাণ রক্ষা করে, সে যেন সমগ্র মানবজাতিকে রক্ষা করল।</div>
      </div>
    </div>
  </div>

  <!-- লাইব্রেরি -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    const urlParams = new URLSearchParams(window.location.search);
    const data = {
      id: urlParams.get('id') || 'DINAJ-0000',
      name: urlParams.get('name') || 'নাম নেই',
      group: urlParams.get('group') || 'N/A',
      mobile: urlParams.get('mobile') || 'নাম্বার নেই',
      upazila: urlParams.get('upazila') || 'উপজেলা নেই',
      total_donation: urlParams.get('total_donation') || '0'
    };

    // কার্ডে তথ্য
    document.getElementById('cardID').textContent = ', ' + data.id;
    document.getElementById('cardname').textContent = data.name;
    document.getElementById('logo-bg').textContent = 'রক্তের গ্রুপ: ' + data.group;
    document.getElementById('cardmobile').textContent = data.mobile;
    document.getElementById('cardupazila').textContent = 'দিনাজপুর, ' + data.upazila;
    document.getElementById('carddonations').textContent = data.total_donation + ' বার';

    const today = new Date().toLocaleDateString('bn-BD', { day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById('carddate').textContent = 'কার্ড প্রদানের তারিখ: ' + today;

    const card = document.getElementById('card');
    card.classList.add('filled');

    // ছবি আপলোড
    const container = document.getElementById('userPhotoContainer');
    const img = document.getElementById('cardUserPhoto');
    document.getElementById('userPhoto').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        img.src = url;
        img.onload = () => container.classList.remove('empty');
      }
    });

    // PNG ডাউনলোড
    document.getElementById('downloadPNG').onclick = () => generateImage('png');
    // PDF ডাউনলোড
    document.getElementById('downloadPDF').onclick = () => generateImage('pdf');

    async function generateImage(format) {
      const clone = card.cloneNode(true);
      clone.style.position = 'absolute';
      clone.style.left = '-9999px';
      clone.style.boxShadow = 'none';
      clone.style.width = '1080px';
      clone.style.height = '566px';
      clone.style.transform = 'none';
      document.body.appendChild(clone);

      try {
        const canvas = await html2canvas(clone, { scale: 3, useCORS: true });
        const imgData = canvas.toDataURL('image/png');

        if (format === 'png') {
          const a = document.createElement('a');
          a.download = `রক্তদাতা_কার্ড_${data.id}.png`;
          a.href = imgData;
          a.click();
        } else if (format === 'pdf') {
          const doc = new jsPDF({
            orientation: 'landscape',
            unit: 'px',
            format: [1080, 566]
          });
          doc.addImage(imgData, 'PNG', 0, 0, 1080, 566);
          doc.save(`রক্তদাতা_কার্ড_${data.id}.pdf`);
        }
      } catch (err) {
        alert('ডাউনলোডে সমস্যা: ' + err.message);
      } finally {
        document.body.removeChild(clone);
      }
    }
  </script>
</body>
</html>